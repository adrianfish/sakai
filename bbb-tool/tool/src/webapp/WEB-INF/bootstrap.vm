<!--

    Copyright (c) 2010 onwards - The Sakai Foundation

    Licensed under the Educational Community License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

                http://www.osedu.org/licenses/ECL-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
      xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="${isoLanguage}"
      lang="${isoLanguage}">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script>
        var d = new Date();
        var browserTimezoneOffset = (d.getTimezoneOffset() * 60 * 1000 * -1).toString();
        var meetings = {
            startupArgs: {
                language: '${language}',
                siteId: '${siteId}',
                skin: '${skin}',
                state: '${state}',
                timezoneoffset: '${timezoneOffset}',
                sakaiVersion: '${sakaiVersion}',
                maxFileSizeInBytes: '${maxFileSizeInBytes}',
                checkICalOption: ${checkICalOption},
             }
        };
    </script>
    ${sakaiHtmlHead}
    <link rel="stylesheet" type="text/css" href="/bbb-tool/css/bbb.css" />
    <link rel="stylesheet" type="text/css" href="/bbb-tool/lib/jquery.datepick.package-3.7.5/redmond.datepick.css" />
    <script src="/library/webjars/jquery/1.12.4/jquery.min.js"></script>
    <script src="/library/js/trimpath-template-latest.js"></script>
    <script src="/bbb-tool/lib/jquery.tablesorter.min.js"></script>
    <script src="/bbb-tool/lib/jquery.datepick.package-3.7.5/jquery.datepick.pack.js"></script>
    <script src="/bbb-tool/lib/jquery.browser.min.js"></script>
    <script src="/bbb-tool/lib/jquery.timePicker.js"></script>
    <script src="/bbb-tool/lib/jquery.tipTip.minified.js"></script>
</head>
<body>

<div class="portletBody">

<div id="bbb_toolbar" class="portletBody"></div>
<div id="bbb_messages" style="display: none"></div>
<div id="bbb_container">
    <div id="bbb_content"></div>
</div>

<!--  Templates Start -->

<div id="bbb_recordings_template" style="display:none"><!--
{if stateFunction == "recordings_meeting"}
    <span>
        <button onclick="return meetings.switchState('meetingInfo', {'meetingId': '${D}{meetingId}'})" title="${D}{bbb_back_button_tooltip}"><i class="fa fa-arrow-left"></i>&nbsp;${D}{bbb_back_button}</button>
    </span>
{else}
    <button onclick="meetings.switchState('recordings')" title="${D}{bbb_refresh}"><i class="fa fa-refresh"></i>&nbsp;${D}{bbb_refresh}</button>
{/if}
    <input type="text" class="search" id="recSearch" placeholder=${bbb_search}>
    <table id="bbb_recording_table" class="listHier">
        <thead>
            <tr>
                <th class="bbb_recName">${D}{bbb_th_recordingname}</th>
                <th class="bbb_recPreview">${D}{bbb_th_recordingpreview}</th>
                <th class="bbb_recStatus">${D}{bbb_th_status}</th>
                <th class="bbb_recStartDate">${D}{bbb_th_recordingdate}</th>
                <th class="bbb_recLinks">${D}{bbb_th_recordings}</th>
                <th class="bbb_recLength">${D}{bbb_th_recordinglength}</th>
            </tr>
        </thead>
        <tbody>
        {for r in recordings}
          {if r.canEdit || r.published == 'true'}
            <tr class="recordingRow">
                <td>
                    <span>${D}{r.name}</span>
                    <div class="itemAction" style="margin:0; padding:0;">
                        <small>
                        {if r.canEdit}
                          {if r.published == 'true'}
                            <a href="javascript:;" onclick="return meetings.utils.unpublishRecordings('${D}{r.meetingID}','${D}{r.recordID}','${D}{stateFunction}');" title="${D}{bbb_action_hide_tooltip}">${D}{bbb_action_hide}</a>
                          {else}
                            <a href="javascript:;" onclick="return meetings.utils.publishRecordings('${D}{r.meetingID}','${D}{r.recordID}','${D}{stateFunction}');" title="${D}{bbb_action_show_tooltip}">${D}{bbb_action_show}</a>
                          {/if}
                        {/if}
                        {if r.canDelete}
                            &nbsp;|&nbsp;
                            <a href="javascript:;" onclick="return meetings.utils.deleteRecordings('${D}{r.meetingID}','${D}{r.recordID}','${D}{stateFunction}','${D}{escape(r.name)} [${D}{new Date(parseInt(r.startTime)).toISO8601String()}]');" title="${D}{bbb_action_delete_recording_tooltip}">${D}{bbb_action_delete_recording}</a>
                        {/if}
                        {if r.canDelete}
                          {if r.protected}
                            &nbsp;|&nbsp;
                            {if r.protected == 'true'}
                              <a href="javascript:;" onclick="return meetings.utils.unprotectRecordings('${D}{r.meetingID}','${D}{r.recordID}','${D}{stateFunction}');" title="${D}{bbb_action_unprotect_tooltip}">${D}{bbb_action_unprotect}</a>
                            {else}
                              <a href="javascript:;" onclick="return meetings.utils.protectRecordings('${D}{r.meetingID}','${D}{r.recordID}','${D}{stateFunction}');" title="${D}{bbb_action_protect_tooltip}">${D}{bbb_action_protect}</a>
                            {/if}
                          {/if}
                        {/if}
                        </small>
                    </div>
                </td>
                <td class="bbb_thumbnails">
                    <div class="bbb_preview_images">
                        {if r.images && r.published == 'true'}
                            {for image in r.images}
                            <a href="${D}{image.url}" class="preview" target="_blank">
                                <img src="${D}{image.url}" class="thumbnails" width="44px" height="34px" alt="${D}{image.title}">
                            </a>
                            {/for}
                        {elseif r.images}
                            ${D}{bbb_recording_thumbnails_hidden}
                        {/if}
                    </div>
                </td>
                <td>
                  {if r.published == 'true'}
                    ${D}{bbb_recording_status_shown}
                  {else}
                    ${D}{bbb_recording_status_hidden}
                  {/if}
                </td>
                <td class="bbb_startDate">${D}{r.formattedStartTime}</td>
                <td>
                  {for p in r.playback}
                    {var recType = bbb_recording_type[p.type] === undefined ? p.type : bbb_recording_type[p.type]}
                    {var viewRecType = bbb_recording_view_tooltip[p.type] === undefined ? p.type : bbb_recording_view_tooltip[p.type]}
                    {if r.published == 'true'}
                        <a href="${D}{p.url}" title="${D}{viewRecType}" target="_blank">${D}{recType}</a>&nbsp;
                    {else}
                        ${D}{recType}&nbsp;
                    {/if}
                  {/for}
                </td>
                <td>${D}{r.formattedDuration}</td>
            </tr>
          {/if}
        {/for}
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
-->
</div>

<div id="bbb_permissions_template" style="display:none"><!--
<sakai-permissions tool="meetings">
-->
</div>

<div id="bbb_meeting-info_template" style="display:none"><!--
    <h3>${D}{bbb_meetinginfo_title}</h3>
        <br/>
    <table cellpadding="0" cellspacing="0" border="0" id="bbb_meeting_info_table">
      {if groups && meeting.groupSessions}
      <tr>
        <td><h5>${D}{bbb_meetinginfo_group}</h5></td>
        <td>
            <select id="groupSession">
                <option selected value="Default">${D}{bbb_meetinginfo_defaultGroup}</option>
            {for group in groups}
                <option value="${D}{group.groupId}">${D}{group.groupTitle}</option>
            {/for}
            </select>
        </td>
      </tr>
      {/if}
      <tr>
        <td><h5>${D}{bbb_info_title}</h5></td>
        <td id="meetingName">${D}{meeting.name}</td>
      </tr>
      <tr>
        <td><h5>${D}{bbb_info_description}</h5></td>
        <td>${D}{meeting.properties.welcomeMessage}</td>
      </tr>
      {if meeting.startDate}
      <tr>
        <td><h5>${D}{bbb_availability_startdate}</h5></td>
        <td>${D}{new Date(parseInt(meeting.startDate) - parseInt(browserTimezoneOffset) + parseInt(timezoneoffset)).toISO8601String()}</td>
      </tr>
      {/if}
      {if meeting.endDate}
      <tr>
        <td><h5>${D}{bbb_availability_enddate}</h5></td>
        <td>${D}{new Date(parseInt(meeting.endDate) - parseInt(browserTimezoneOffset) + parseInt(timezoneoffset)).toISO8601String()}</td>
      </tr>
      {/if}
      <tr>
        <td><h5>${D}{bbb_meetinginfo_status}</h5></td>
        <td>
            {var dispNotStarted = meeting.notStarted ? 'display:inline' : 'display:none'}
            {var dispInProgress = meeting.joinable ? 'display:inline' : 'display:none'}
            {var dispFinished = meeting.finished ? 'display:inline' : 'display:none'}
            {var labelJoinable = meeting.joinableMode == 'available'? bbb_status_joinable_available: meeting.joinableMode == 'inprogress'? bbb_status_joinable_inprogress: meeting.joinableMode == 'unavailable'? bbb_status_joinable_unavailable: meeting.joinableMode == 'unreachable'? bbb_status_joinable_unreachable: ''}
            <span id="meeting_status_notstarted_${D}{meeting.id}" class="bbb_status_notstarted" style="${D}{dispNotStarted}">
                ${D}{bbb_status_notstarted}
            </span>
            <span id="meeting_status_joinable_${D}{meeting.id}" class="status_joinable_inprogress" style="${D}{dispInProgress}">
                ${D}{labelJoinable}
            </span>
            <span id="meeting_status_finished_${D}{meeting.id}" class="bbb_status_finished" style="${D}{dispFinished}">
                ${D}{bbb_status_finished}
            </span>
            {var displayLink = meeting.joinUrl && meeting.joinable && meeting.joinableMode == 'available'? 'display:inline' : 'display:none'}
            <span id="meetingStatus">
                (
                <span id="meeting_joinlink_${D}{meeting.id}" style="${D}{displayLink}">
                        {var multiplesessions = meeting.multipleSessionsAllowed && meetings.settings.config.addUpdateFormParameters.multiplesessionsallowedEnabled}
                        {if meeting.joinable && meetings.userPerms.bbbParticipate}
                            <a id="joinMeetingLink" target="_blank" href="javascript:;" onclick="return meetings.utils.joinMeeting('${D}{meeting.id}', '#joinMeetingLink', ${D}{multiplesessions});" title="${D}{bbb_meetinginfo_launch_meeting_tooltip}" style="font-weight:bold">${D}{bbb_meetinginfo_link}</a>
                            <i class="fa fa-sign-in"></i>
                        {/if}
                </span>
                {if meeting.canEnd}
                {var end_meetingClass = (meeting.joinable && meeting.joinableMode == 'inprogress')? "bbb_end_meeting_shown": "bbb_end_meeting_hidden" }
                <div id="end_meeting_intermediate_${D}{meeting.id}" class="${D}{end_meetingClass}" >
                    &nbsp;|&nbsp;
                    <a id="end_session_link" href="javascript:;" onclick="return meetings.utils.endMeeting('${D}{escape(meeting.name)}','${D}{meeting.id}');" title="${D}{bbb_action_end_meeting_tooltip}" style="font-weight:bold">${D}{bbb_action_end_meeting}</a>
                    <span><i class="fa fa-stop"></i></span>
                </div>
                {/if}
                )
            <span>
        </td>
      </tr>
      <tr id="bbb_meeting_info_participants_count_tr" style="display:none">
        <td><h5>${D}{bbb_meetinginfo_participants_count}</h5></td>
        <td>
            <span id="bbb_meeting_info_participants_count"></span>
            <a id="updateMeetingInfo" href="javascript:;" onclick="meetings.utils.checkOneMeetingAvailability('${D}{meeting.id}'); return false;" title="${D}{bbb_meetinginfo_updateinfo_tooltip}">
                <i class="fa fa-refresh" title="${D}{bbb_refresh}"></i>
            </a>
        </td>
      </tr>
      {var hideRecordings = !meetings.userPerms.bbbRecordingView || !meetings.settings.config.addUpdateFormParameters.recordingEnabled || !meeting.recording}
      <tr id="meeting_recordings" {if hideRecordings}style="display:none;"{/if}>
        <td><h5>${D}{bbb_info_recordings}</h5></td>
        <td id="recording_link_${D}{meeting.id}">
        </td>
      </tr>
    </table>
-->
</div>

<script type="module">
    import {loadMeetings} from "/bbb-tool/js/bbb.js";
    loadMeetings();
</script>

</div> <!-- /portletBody -->

</body>
</html>
